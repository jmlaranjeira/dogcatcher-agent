# =============================================================================
# DOGCATCHER AGENT CONFIGURATION
# =============================================================================
# Copy this file to .env and fill in your values

# -----------------------------------------------------------------------------
# LLM Provider: "openai" (default) or "bedrock"
# -----------------------------------------------------------------------------
LLM_PROVIDER=openai

# OpenAI settings (used when LLM_PROVIDER=openai)
OPENAI_API_KEY=<your_openai_api_key>
OPENAI_MODEL=gpt-4.1-nano
OPENAI_RESPONSE_FORMAT=json_object
OPENAI_TEMPERATURE=0

# AWS Bedrock settings (used when LLM_PROVIDER=bedrock)
# AWS_REGION=eu-west-1
# BEDROCK_MODEL_ID=anthropic.claude-3-haiku-20240307-v1:0
# BEDROCK_TEMPERATURE=0
# BEDROCK_MAX_TOKENS=4096

DATADOG_API_KEY=<your_datadog_api_key>
DATADOG_APP_KEY=<your_datadog_app_key>

JIRA_DOMAIN=<your_jira_domain>
JIRA_USER=<your_jira_user>
JIRA_API_TOKEN=<your_jira_api_token>
JIRA_PROJECT_KEY=<your_jira_project_key>

# -----------------------------------------------------------------------------
# Datadog Configuration
# -----------------------------------------------------------------------------
DATADOG_SERVICE=myservice
DATADOG_ENV=prod
DATADOG_HOURS_BACK=24
DATADOG_LIMIT=50
DATADOG_MAX_PAGES=3
DATADOG_TIMEOUT=20
DATADOG_STATUSES=error
DATADOG_SITE=datadoghq.eu

# Datadog Query Extra - Filter out false positives using errorType tags
# This works with services that use structured logging with errorType field
# See: docs/LOGGING_IMPROVEMENTS.md for implementation details
DATADOG_QUERY_EXTRA=-@errorType:(BUSINESS_VALIDATION OR NOT_FOUND OR INVALID_INPUT)
DATADOG_QUERY_EXTRA_MODE=AND

# Datadog Logs URL for trace links in tickets
DATADOG_LOGS_URL=https://app.datadoghq.eu/logs

# -----------------------------------------------------------------------------
# Agent Behavior
# -----------------------------------------------------------------------------
AUTO_CREATE_TICKET=false            # Set to true for real mode
MAX_TICKETS_PER_RUN=3               # Safety cap on tickets per run (0=unlimited)
COMMENT_ON_DUPLICATE=true           # Comment on existing duplicate tickets
COMMENT_COOLDOWN_MINUTES=120        # Cooldown between comments on same ticket

# -----------------------------------------------------------------------------
# Jira Similarity Thresholds (optimized defaults)
# -----------------------------------------------------------------------------
JIRA_SIMILARITY_THRESHOLD=0.82      # Fuzzy match threshold (tested optimal)
JIRA_DIRECT_LOG_THRESHOLD=0.90      # Direct match threshold (high confidence)
JIRA_PARTIAL_LOG_THRESHOLD=0.70     # Partial match threshold (edge cases)

# -----------------------------------------------------------------------------
# Jira Search Parameters (performance optimized)
# -----------------------------------------------------------------------------
JIRA_SEARCH_MAX_RESULTS=200         # Max results per search (comprehensive)
JIRA_SEARCH_WINDOW_DAYS=365         # Search window in days (full coverage)

# -----------------------------------------------------------------------------
# Severity Rules (JSON format)
# -----------------------------------------------------------------------------
# Map error_type to severity: low, medium, high
# Example: {"database-error": "high", "validation-error": "low"}
SEVERITY_RULES_JSON={"INTEGRATION_FAILURE": "high", "DATABASE_ERROR": "high", "AUTHENTICATION_ERROR": "high", "UNEXPECTED_ERROR": "medium"}

# -----------------------------------------------------------------------------
# Error Aggregation
# -----------------------------------------------------------------------------
AGGREGATE_EMAIL_NOT_FOUND=false     # Aggregate email-not-found errors
AGGREGATE_KAFKA_CONSUMER=false      # Aggregate kafka-consumer errors

# -----------------------------------------------------------------------------
# Occurrence-based Escalation
# -----------------------------------------------------------------------------
OCC_ESCALATE_ENABLED=false          # Enable occurrence-based escalation
OCC_ESCALATE_THRESHOLD=10           # Escalation threshold
OCC_ESCALATE_TO=high                # Target severity for escalation

# -----------------------------------------------------------------------------
# Async Processing (Phase 2)
# -----------------------------------------------------------------------------
ASYNC_ENABLED=true                  # Enable async parallel processing
ASYNC_MAX_WORKERS=3                 # Optimal: 3 workers (benchmarked)
ASYNC_BATCH_SIZE=10                 # Batch size for async processing
ASYNC_TIMEOUT_SECONDS=60            # Timeout per log in async mode
ASYNC_RATE_LIMITING=true            # Enable rate limiting for API calls

# -----------------------------------------------------------------------------
# Cache Configuration
# -----------------------------------------------------------------------------
CACHE_BACKEND=memory                # Options: redis, file, memory
CACHE_TTL_SECONDS=3600              # Cache TTL in seconds

# -----------------------------------------------------------------------------
# Circuit Breaker (Resilience)
# -----------------------------------------------------------------------------
CIRCUIT_BREAKER_ENABLED=true        # Enable circuit breaker for LLM calls
FALLBACK_ANALYSIS_ENABLED=true      # Enable rule-based fallback analysis

# -----------------------------------------------------------------------------
# Observability / DogStatsD Metrics - Optional
# -----------------------------------------------------------------------------
DATADOG_METRICS_ENABLED=false          # Enable custom metric emission
# DD_AGENT_HOST=localhost              # DogStatsD agent host
# DD_AGENT_PORT=8125                   # DogStatsD agent port
# METRICS_PREFIX=dogcatcher            # Prefix for all custom metrics

# -----------------------------------------------------------------------------
# Patchy (Self-healing PR Bot) - Optional
# -----------------------------------------------------------------------------
# GITHUB_TOKEN=<your_github_token>
# PATCHY_WORKSPACE=/tmp/patchy-workspace
# REPAIR_ALLOWED_SERVICES=myservice
# REPAIR_MAX_PRS_PER_RUN=3
